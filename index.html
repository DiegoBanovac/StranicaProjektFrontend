<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Imigranti</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <main class="table">
      <section class="table_header">
        <h1>
          Broj novih imigranata u drzavama na podruciju Europe u posljednih 10
          godina
        </h1>
        <div class="input-group">
          <input type="search" placeholder="Search" />
          <img src="img/search.png" />
        </div>
        <button id="toggleChart" class="blue-button">Generate Chart</button>
      </section>
      <section class="table_body">
        <table id="dataTable">
          <thead>
            <tr>
              <th>Country<span class="icon-arrow">&UpArrow;</span></th>
              <th>2014<span class="icon-arrow">&UpArrow;</span></th>
              <th>2015<span class="icon-arrow">&UpArrow;</span></th>
              <th>2016<span class="icon-arrow">&UpArrow;</span></th>
              <th>2017<span class="icon-arrow">&UpArrow;</span></th>
              <th>2018<span class="icon-arrow">&UpArrow;</span></th>
              <th>2019<span class="icon-arrow">&UpArrow;</span></th>
              <th>2020<span class="icon-arrow">&UpArrow;</span></th>
              <th>2021<span class="icon-arrow">&UpArrow;</span></th>
              <th>2022<span class="icon-arrow">&UpArrow;</span></th>
              <th>2023<span class="icon-arrow">&UpArrow;</span></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>
      <section class="chart_section hidden">
        <canvas id="myChart" width="400" height="200"></canvas>
      </section>
    </main>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const dataTable = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
        const toggleChartButton = document.getElementById('toggleChart');
        const chartSection = document.querySelector('.chart_section');
        const ctx = document.getElementById('myChart').getContext('2d');
        let chart;

        // Fetch data from the API
        fetch('https://stranicaprojektfrontend.onrender.com/data')
          .then(response => response.json())
          .then(data => {
            data.forEach(row => {
              const newRow = dataTable.insertRow();
              Object.values(row).forEach(cellData => {
                const newCell = newRow.insertCell();
                newCell.textContent = cellData;
              });
            });
          })
          .catch(error => console.error('Error fetching data:', error));

        // Toggle chart visibility and generate chart
        toggleChartButton.addEventListener('click', () => {
          chartSection.classList.toggle('hidden');
          if (!chart) {
            // Generate chart data (example: total immigrants per year)
            const labels = ['2014', '2015', '2016', '2017', '2018', '2019', '2020', '2021', '2022', '2023'];
            const chartData = labels.map(label => {
              return data.reduce((sum, row) => sum + (parseInt(row[label]) || 0), 0);
            });

            chart = new Chart(ctx, {
              type: 'line',
              data: {
                labels: labels,
                datasets: [{
                  label: 'Total Immigrants',
                  data: chartData,
                  backgroundColor: 'rgba(75, 192, 192, 0.2)',
                  borderColor: 'rgba(75, 192, 192, 1)',
                  borderWidth: 1
                }]
              },
              options: {
                responsive: true,
                scales: {
                  y: {
                    beginAtZero: true
                  }
                }
              }
            });
          }
        });
      });
    </script>
    <script src="script.js"></script>
  </body>
</html>
